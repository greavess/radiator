<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>MAF/MAC filter — filter_maf • radiator</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="MAF/MAC filter — filter_maf" />
<meta property="og:description" content="Minor Allele Filter.
Remove markers based on Minor/Alternate Allele Frequency (MAF) or Count (MAC).
Most arguments are inherited from
tidy_genomic_data." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">radiator</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Installation</a>
</li>
<li>
  <a href="../articles/get_started.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/rad_genomics_computer_setup.html">Computer setup - Installation - Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/life_cycle.html">Life cycle</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/thierrygosselin/radiator">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>MAF/MAC filter</h1>
    <small class="dont-index">Source: <a href='https://github.com/thierrygosselin/radiator/blob/master/R/filter_maf.R'><code>R/filter_maf.R</code></a></small>
    <div class="hidden name"><code>filter_maf.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Minor Allele Filter.
Remove markers based on Minor/Alternate Allele Frequency (MAF) or Count (MAC).</p>
<p>Most arguments are inherited from
<code><a href='tidy_genomic_data.html'>tidy_genomic_data</a></code>.</p>
    </div>

    <pre class="usage"><span class='fu'>filter_maf</span><span class='op'>(</span>
  interactive.filter <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>data</span>,
  strata <span class='op'>=</span> <span class='cn'>NULL</span>,
  maf.thresholds <span class='op'>=</span> <span class='cn'>NULL</span>,
  filename <span class='op'>=</span> <span class='cn'>NULL</span>,
  parallel.core <span class='op'>=</span> <span class='fu'>parallel</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/r/parallel/detectCores.html'>detectCores</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>1</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>interactive.filter</th>
      <td><p>(optional, logical) Do you want the filtering session to
be interactive. With default: <code>interactive.filter == TRUE</code>, figures and
tables are shown before making decisions for filtering.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>14 options for input (<strong>diploid data only</strong>): VCFs (SNPs or Haplotypes,
to make the vcf population ready),
plink (tped, bed), stacks haplotype file, genind (library(adegenet)),
genlight (library(adegenet)), gtypes (library(strataG)), genepop, DArT,
and a data frame in long/tidy or wide format. To verify that radiator detect
your file format use <code><a href='detect_genomic_format.html'>detect_genomic_format</a></code> (see example below).
Documented in <strong>Input genomic datasets</strong> of <code><a href='tidy_genomic_data.html'>tidy_genomic_data</a></code>.</p>
<p><strong>DArT and VCF data</strong>: <span class="pkg">radiator</span> was not meant to generate alleles
and genotypes if you are using a VCF file with no genotype
(only genotype likelihood: GL or PL).
Neither is <span class="pkg">radiator</span> able to magically generate a genind object
from a SilicoDArT dataset. Please look at the first few lines of your dataset
to understand it's limit before asking raditor to convert or filter your dataset.</p></td>
    </tr>
    <tr>
      <th>strata</th>
      <td><p>(optional)
The strata file is a tab delimited file with a minimum of 2 columns headers:
<code>INDIVIDUALS</code> and <code>STRATA</code>. Documented in <code><a href='read_strata.html'>read_strata</a></code>.
DArT data: a third column <code>TARGET_ID</code> is required.
Documented on <code><a href='read_dart.html'>read_dart</a></code>. Also use the strata read function to
blacklist individuals.
Default: <code>strata = NULL</code>.</p></td>
    </tr>
    <tr>
      <th>maf.thresholds</th>
      <td><p>(optional, string) 5 values required in the string.</p>
<p>Example using maf.thresholds with SNP and frequency approach:
<code>maf.thresholds = c("SNP", 0.001, "OR", 0.001, 1)</code>.</p>
<p>Example using maf.thresholds with locus and count approach:
<code>maf.thresholds = c("locus", 3, "OR", 6, 1)</code>.</p>

<ol>
<li><p><code>maf approach</code> (character: "SNP"/"locus"):
MAF filtering is conducted by SNPs or locus.
<code>"SNP"</code>: will consider all the SNPs on the same locus/read as independent
and will be filtered independently of their locus id.
<code>"locus"</code>: looks at the minimum MAF found on the
read/locus. Using this option will discard all the markers/snp on
that read based on the thresholds chosen. For the locus approach to work, your dataset
requires SNP and Locus info (e.g. from a VCF file).</p></li>
<li><p><code>local</code> threshold (double or integer): For a frequency threshold use
a double (e.g. 0.05). For a count threshold, use an integer
(e.g. 3 for the number of alternate allele required in a population). This
threshold is applied by population.
Not sure about the threshold to use, choose the interactive mode argument.</p></li>
<li><p><code>operator</code> (character: "OR" / "AND"):
To consider both the local <code>"AND"</code> the global thresholds, use <code>"AND"</code>.
To consider the local <code>"OR"</code> the global thresholds, use <code>"OR"</code>.</p></li>
<li><p><code>global</code> threshold (double or integer): For a frequency threshold
use a double (e.g. 0.02). For a count threshold, use an integer
(e.g. 6 for the number of alternate allele required). This threshold is
applied at the dataset level (no population).
Not sure about the threshold to use, choose the interactive mode argument.</p></li>
<li><p><code>maf pop num threshold</code> (integer)
The number of pop required to pass the thresholds
to keep the marker. Usually, I always use <code>1</code>, for 1 pop is required to
pass thresholds and keep the marker.</p></li>
</ol></td>
    </tr>
    <tr>
      <th>filename</th>
      <td><p>(optional, character) Write to folder the MAF filtered
tidy dataset. The name will be appended <code>.rad</code>. With default, the filtered
data is only in the global environment.
Default: <code>filename = NULL</code>.</p></td>
    </tr>
    <tr>
      <th>parallel.core</th>
      <td><p>(optional) The number of core used for parallel
execution during import.
Default: <code>parallel.core = parallel::detectCores() - 1</code>.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>(optional, logical) When <code>verbose = TRUE</code>
the function is a little more chatty during execution.
Default: <code>verbose = TRUE</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>(optional) To pass further arguments for fine-tuning the function
and legacy arguments (see Life cycle section below).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>With <code>interactive.filter = FALSE</code>, a list in the global environment,
with 7 objects:</p><ol>
<li><p>$tidy.filtered.maf</p></li>
<li><p>$whitelist.markers</p></li>
<li><p>$blacklist.markers</p></li>
<li><p>$maf.data</p></li>
<li><p>$filters.parameters</p></li>
</ol>

<p>With <code>interactive.filter = TRUE</code>, a list with 4 additionnal objects are generated.</p><ol>
<li><p>$distribution.maf.global</p></li>
<li><p>$distribution.maf.local</p></li>
<li><p>$maf.global.summary</p></li>
<li><p>$maf.helper.table</p></li>
</ol>

<p><strong>maf.helper.table:</strong></p>
<p>First and second variables (in columns) represents POP_ID and sample size (n).</p>
<p>The last 2 rows are the local MAF (suggested based on the lowest pop value)
and the TOTAL/GLOBAL observations.</p>
<p>Columns starting with ALT are the variable corresponding
to the number of alternative (ALT) allele (ranging from 1 to 20).
The observations in the ALT allele variable columns are the local (for the pop)
and global (last row) MAF of your dataset.
e.g. ALT_3 can potentially represent 3 heterozygote individuals with
the ALT allele or 1 homozygote individuals for the ALT allele and
1 heterozygote individual. And so on...</p>
    <h2 class="hasAnchor" id="life-cycle"><a class="anchor" href="#life-cycle"></a>Life cycle</h2>

    


<p>The <strong>maf.thresholds</strong> arguments used in the past in several of
radiator functions
is still available inside <code>filter_maf</code> arguments.
But it is in evaluation mode and the function will probaly be deprecated in
future releases. The arguments are complicated to use and
most RADseq datesets encountered so far are better filtered
using <code><a href='filter_mac.html'>filter_mac</a></code>.</p>
    <h2 class="hasAnchor" id="mac-or-maf-"><a class="anchor" href="#mac-or-maf-"></a>MAC or MAF ?</h2>

    

<p>Using count or frequency to remove a SNPs ? The preferred choice in radiator
as changed from frequency to count, because we think the filtering should not
alter the spectrum and this is only achieved if the same criteria is applied
for each SNP.</p>

<p>Even small differences in missing data between RADseq markers
generates differences in MAF frequency thresholds applied.</p>
<p>Example with a datset consisting of N = 36 individuals and 3 SNPs
with varying level of missing genotypes:</p>
<ul>
<li><p><code>SNP number : number samples genotypes : REF/ALT counts</code></p></li>
<li><p>SNP1 : 36 : 69/3</p></li>
<li><p>SNP2 : 30 : 65/3</p></li>
<li><p>SNP3 : 24 : 45/3</p></li>
</ul>

<p>Each SNPs have the same alternate allele count, corresponding to
2 individuals with the polymorphism: 1 homozygote + 1 heterozygote.
Applying a MAF threshold of
0.05 would mean that SNP3 would be blacklisted
(<code>24 * 2 * 0.05 = 2.4 alt alleles required to pass</code>).</p>

<p><strong>Using count instead of frequency allows each RADseq markers,
with varying missing data, to be treated equally.</strong></p>
    <h2 class="hasAnchor" id="interactive-version"><a class="anchor" href="#interactive-version"></a>Interactive version</h2>

    


<p>To help choose a threshold for the local and global MAF
use the interactive version.</p>
<p>2 steps in the interactive version:</p>
<p>Step 1. Global and Local MAF visualization and helper table.</p>
<p>Step 2. Filtering markers based on the different MAF arguments</p>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Thierry Gosselin <a href='mailto:thierrygosselin@icloud.com'>thierrygosselin@icloud.com</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'>if</span> <span class='op'>(</span><span class='cn'>FALSE</span><span class='op'>)</span> <span class='op'>{</span>
<span class='co'># The minumum</span>
<span class='va'>turtle.maf</span> <span class='op'>&lt;-</span> <span class='fu'>radiator</span><span class='fu'>::</span><span class='fu'>filter_maf</span><span class='op'>(</span>
        data <span class='op'>=</span> <span class='st'>"turtle.vcf"</span>,
        strata <span class='op'>=</span> <span class='st'>"turtle.strata.tsv"</span><span class='op'>)</span>
<span class='co'># This will use the default: interactive version,</span>
<span class='co'># a list is created and to view the filtered tidy data:</span>
<span class='va'>tidy.data</span> <span class='op'>&lt;-</span> <span class='va'>turtle.maf</span><span class='op'>$</span><span class='va'>tidy.filtered.maf</span>

<span class='co'># The remaining argument are used in tidy_genomic_data during import and allow</span>
<span class='co'># the user to apply some filtering or selection before doing the MAF filtering.</span>

<span class='co'># If I want to filter Alternate alleles based on count.</span>
<span class='va'>turtle.maf</span> <span class='op'>&lt;-</span> <span class='fu'>radiator</span><span class='fu'>::</span><span class='fu'>filter_maf</span><span class='op'>(</span>
        data <span class='op'>=</span> <span class='st'>"turtle.vcf"</span>,
        strata <span class='op'>=</span> <span class='st'>"turtle.strata.tsv"</span>,
        maf.thresholds <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"SNP"</span>, <span class='fl'>3</span>, <span class='st'>"OR"</span>, <span class='st'>"5"</span>, <span class='fl'>1</span><span class='op'>)</span>,
        filename <span class='op'>=</span> <span class='st'>"turtle.maf"</span><span class='op'>)</span>

<span class='co'># This will remove monomorphic markers (by default filter.monomorphic = TRUE)</span>
<span class='co'># it will use the SNP approache (SNPs are considered independent and</span>
<span class='co'># filtered independent)</span>
<span class='co'># I keep markers if: they have a local count of 3 alternate allele OR global</span>
<span class='co'># count of 5 alternate allele.</span>
<span class='co'># I keep the marker if at leat 1 pop pass that.</span>
<span class='co'># finally the filtered data will be written in the directory under the name:</span>
<span class='co'># turtle.maf.rad</span>
<span class='op'>}</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Thierry Gosselin.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


